{"title":"CentOS下使用Nginx+Git部署hexo","date":"2020-02-29T07:16:37.000Z","date_formatted":{"ll":"Feb 29, 2020","L":"02/29/2020","MM-DD":"02-29"},"thumbnail":"https://i.loli.net/2020/02/29/az4l93ZMwbC8dXu.jpg","link":"2020/02/29/nginxServer","comments":true,"tags":["Hexo","Nginx","Web","前端"],"categories":["教程"],"updated":"2020-12-14T15:10:11.497Z","content":"<h2 id=\"服务器端\">服务器端<a title=\"#服务器端\" href=\"#服务器端\"></a></h2>\n<h3 id=\"安装依赖组件\">安装依赖组件<a title=\"#安装依赖组件\" href=\"#安装依赖组件\"></a></h3>\n<p><code>yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel</code></p>\n<p><code>yum install gcc perl-ExtUtils-MakeMaker package</code></p>\n<p><code>yum install git nginx</code></p>\n<h3 id=\"测试nginx\">测试Nginx<a title=\"#测试nginx\" href=\"#测试nginx\"></a></h3>\n<p><strong>启动Nginx</strong></p>\n<p><code>service nginx start</code></p>\n<p>在浏览器中输入IP测试是否能访问默认页面</p>\n<h3 id=\"创建git仓库\">创建Git仓库<a title=\"#创建git仓库\" href=\"#创建git仓库\"></a></h3>\n<p>创建并修改目录的所有权和用户权限</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> /home/git/</span><br><span class=\"line\"><span class=\"built_in\">chown</span> -R <span class=\"variable\">$USER</span>:<span class=\"variable\">$USER</span> /home/git/</span><br><span class=\"line\"><span class=\"built_in\">chmod</span> -R 755 /home/git/</span><br></pre></td></tr></table></figure>\n<p>创建git 仓库</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /home/git/</span><br><span class=\"line\">git init --bare hexoBlog.git</span><br></pre></td></tr></table></figure>\n<p>创建一个新的 git 钩子，用于自动部署</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /home/git/hexoBlog.git/hooks/post-receive</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><strong>Vim 使用</strong><br>\n<code>i: </code>编辑模式<br>\n<code>：</code>命令模式<br>\n<code>Ctrl+C</code>退出编辑模式<br>\n<code>:+w </code>保存文件<br>\n<code>:+q</code>退出Vim</p>\n</blockquote>\n<p>插入以下语句</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!/bin/bash</span><br><span class=\"line\">git --work-tree=/home/hexoBlog --git-dir=/home/git/hexoBlog.git checkout -f</span><br></pre></td></tr></table></figure>\n<p>修改文件权限，使得其可执行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x /home/git/hexoBlog.git/hooks/post-receive</span><br></pre></td></tr></table></figure>\n<h3 id=\"配置-nginx\">配置 Nginx<a title=\"#配置-nginx\" href=\"#配置-nginx\"></a></h3>\n<p>创建 <code>/home/hexoBlog</code> 目录，用于存放博客静态资源</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir /home/hexoBlog/</span><br><span class=\"line\">chown -R $USER:$USER /home/hexoBlog/</span><br><span class=\"line\">chmod -R 755 /home/hexoBlog/</span><br></pre></td></tr></table></figure>\n<p><code>nginx -t</code> 查看 Nginx 配置文件位置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class=\"line\">nginx: configuration file /etc/nginx/nginx.conf test is successful</span><br></pre></td></tr></table></figure>\n<p><code>vim /etc/nginx/nginx.conf</code> 编辑配置文件</p>\n<p>在<code>http</code>下的<code>server</code>节点里编辑<code>root</code>配置，将其中的 root 值改为 <code>/home/hexoBlog</code></p>\n<p>检查配置文件是否准确 <code>nginx -t</code></p>\n<blockquote>\n<p><strong>注：如果这里失败，请注释掉<code>listen 80 default_server;</code>和<code>listen [::]80default_server;</code>这两行，并另起一行添加<code>listen 80;</code></strong></p>\n<p><strong>如果配置文件中不存在server节点，请退出vim，执行以下命令：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/nginx/conf.d/default.conf</span><br></pre></td></tr></table></figure>\n<p>在该文件中做上述修改</p>\n</blockquote>\n<p><code>service nginx restart</code> 重启 Nginx 服务</p>\n<h2 id=\"客户端配置\">客户端配置<a title=\"#客户端配置\" href=\"#客户端配置\"></a></h2>\n<p>编辑hexo根目录下配置文件<code>_config.yml</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deploy:</span><br><span class=\"line\">  type: git</span><br><span class=\"line\">  repo: </span><br><span class=\"line\">    随便起名字: root@服务器IP:/home/git/hexoBlog</span><br><span class=\"line\">  branch: master</span><br></pre></td></tr></table></figure>\n<p>在目录下运行：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo clean</span><br><span class=\"line\">hexo d</span><br></pre></td></tr></table></figure>\n<p>部署成功后，输入公网IP即可访问你的Hexo站点</p>\n<p>如需停止Nginx在远程ssh输入</p>\n<p><code>nginx -s stop</code></p>\n<blockquote>\n<p>引用参考<a href=\"http://www.allalright.site/post/hexo2\" target=\"_blank\">《部署 Hexo 博客到云服务器》</a></p>\n</blockquote>\n","prev":{"title":"Promises第十六章","link":"2020/03/14/PromisesChapter16"},"next":{"title":"Promises第十五章","link":"2020/02/25/PromisesChapter15"},"plink":"http://wardzhou.art/2020/02/29/nginxServer/","toc":[{"id":"服务器端","title":"服务器端","index":"1","children":[{"id":"安装依赖组件","title":"安装依赖组件","index":"1.1"},{"id":"测试nginx","title":"测试Nginx","index":"1.2"},{"id":"创建git仓库","title":"创建Git仓库","index":"1.3"},{"id":"配置-nginx","title":"配置 Nginx","index":"1.4"}]},{"id":"客户端配置","title":"客户端配置","index":"2"}],"reward":true,"copyright":{"author":"Birch","license":"Attribution-NonCommercial-NoDerivatives 4.0 International(<a href=\"https://creativecommons.org/licenses/by-nc-nd/4.0/\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","updated":"December 14, 2020"},"reading_time":"507 words in 3 min"}